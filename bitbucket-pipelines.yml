image: node:16

pipelines:
    tags:
      v*:
        - step:
           script:
             - git remote add sync git@github.com:miyabilink/sukkiri-c3-codes.git
             - git config remote.origin.fetch "+refs/heads/*:refs/remotes/origin/*"
             - git fetch origin
             - git checkout main
             - git pull
             - git merge origin/main
             - git rm -f bitbucket-pipelines.yml
             - git commit -m “不要なファイル類の削除”
             - git filter-branch -f --env-filter "GIT_AUTHOR_NAME='Tatsunori KAITO'; GIT_AUTHOR_EMAIL='kaito@miyabilink.jp'; GIT_COMMITTER_NAME='Tatsunori KAITO'; GIT_COMMITTER_EMAIL='kaito@miyabilink.jp';" --tag-name-filter cat -- --all
             - git push sync --tags
             - git push -f sync main

             # - "curl -H \"Content-Type: application/json\" --data '{\"docker_tag\": \"edge\"}' -X POST $DOCKER_HUB_URL"
             # - "curl -H \"Content-Type: application/json\" --data '{\"docker_tag\": \"latest\"}' -X POST $DOCKER_HUB_URL"
